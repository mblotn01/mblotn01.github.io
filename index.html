<!DOCTYPE html>
<html>
  <head>
    <title>Marauder's Map</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?sensor=true">
    </script>
    <script type="text/javascript">
      function initialize() {
        var mapOptions = {
          center: { lat: 42.376, lng: -71.055},
          zoom: 11
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
      }
      google.maps.event.addDomListener(window, 'load', initialize);


      var latitude = 0;
      var longitude = 0;
      var params;
      var dict;
      var characters;
      var students;

      function success(position) {
          latitude = position.coords.latitude;
          longitude = position.coords.longitude;
	  params = "login=Lucky&lat="+latitude+"&lng="+longitude;
	  console.log("lat: "+latitude+"lon: "+longitude);

      }
      function error() {
	  alert("Unable to retreive your location");
      }

      navigator.geolocation.getCurrentPosition(success, error);

      var xhr;
      xhr = new XMLHttpRequest();
      xhr.open("POST", "http://chickenofthesea.herokuapp.com/sendlocation", true);
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
 
      xhr.onreadystatechange = function() {
          console.log("status: "+xhr.status);
          if(xhr.readyState == 4 && xhr.status == 200){
		document.getElementById("results").innerHTML = xhr.response;
		dict = JSON.parse(xhr.response);
		characters = dict["characters"];
		students = dict["students"];

		var marker = new google.maps.Marker({

			position: { lat: characters[0]["loc"]["latitude"], lng: characters[0]["loc"]["longitude"]},
			map: map,
			title: characters[0]["name"]
			
          });
      }
      }
	
      console.log("current params: "+params);
      xhr.send("login=Lucky&lat=42.405803&lng=-71.1245587");

      

    </script>

  </head>
  <body>
<div id="map-canvas"></div>

<p id="results"></p>
 
  </body>
</html>
